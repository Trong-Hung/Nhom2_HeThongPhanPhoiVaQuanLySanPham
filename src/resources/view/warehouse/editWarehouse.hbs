<!-- filepath: c:\Users\trong\JAVASC\blog\src\resources\views\warehouse\editWarehouse.hbs -->
<div class="container mt-4">
  <h2>üìù S·ª≠a kho</h2>

  <form action="/admin/kho/{{warehouse._id}}?_method=PUT" method="POST">
    <div class="form-group">
      <label for="name">T√™n kho:</label>
      <input type="text" class="form-control" id="name" name="name" value="{{warehouse.name}}" required>
    </div>

    <div class="form-group">
      <label for="detail">ƒê·ªãa ch·ªâ chi ti·∫øt:</label>
      <input type="text" class="form-control" id="detail" name="detail" value="{{warehouse.address}}" required>
    </div>

    <div class="form-group">
      <label for="province">T·ªânh/Th√†nh ph·ªë:</label>
      <select class="form-control" id="province" name="province" required></select>
    </div>
    <div class="form-group">
      <label for="district">Qu·∫≠n/Huy·ªán:</label>
      <select class="form-control" id="district" name="district" required></select>
    </div>
    <div class="form-group">
      <label for="ward">Ph∆∞·ªùng/X√£:</label>
      <select class="form-control" id="ward" name="ward" required></select>
    </div>

    <div class="form-group">
      <label for="type">Lo·∫°i kho:</label>
      <select class="form-control" id="type" name="type" required>
        <option value="central" {{#if (eq warehouse.type "central")}}selected{{/if}}>Kho Trung T√¢m</option>
        <option value="regional" {{#if (eq warehouse.type "regional")}}selected{{/if}}>Kho Kh√°c</option>
      </select>
    </div>

    <div class="form-group" id="parentWarehouseGroup" style="display: {{#if (eq warehouse.type "regional")}}block{{else}}none{{/if}};">
      <label for="parentWarehouse">Kho cha:</label>
      <select class="form-control" id="parentWarehouse" name="parentWarehouse">
        <option value="">Ch·ªçn kho cha</option>
        {{#each centralWarehouses}}
          <option value="{{this._id}}" {{#if (eq this._id warehouse.parentWarehouse)}}selected{{/if}}>{{this.name}}</option>
        {{/each}}
      </select>
    </div>

    <button type="submit" class="btn btn-primary btn-block">üíæ L∆∞u thay ƒë·ªïi</button>
  </form>
</div>

<script>
  document.getElementById("type").addEventListener("change", function () {
    const parentWarehouseGroup = document.getElementById("parentWarehouseGroup");
    if (this.value === "regional") {
      parentWarehouseGroup.style.display = "block";
    } else {
      parentWarehouseGroup.style.display = "none";
    }
  });

  async function loadProvinces() {
    const res = await fetch("https://provinces.open-api.vn/api/?depth=1");
    const data = await res.json();
    const provinceSelect = document.getElementById("province");
    provinceSelect.innerHTML = '<option value="">Ch·ªçn T·ªânh/Th√†nh ph·ªë</option>';
    data.forEach(p => {
      provinceSelect.innerHTML += `<option value="${p.code}" ${p.name === "{{warehouse.province}}" ? "selected" : ""}>${p.name}</option>`;
    });
  }

  async function loadDistricts(provinceCode) {
    if (!provinceCode) {
      document.getElementById("district").innerHTML = '<option value="">Ch·ªçn Qu·∫≠n/Huy·ªán</option>';
      document.getElementById("ward").innerHTML = '<option value="">Ch·ªçn Ph∆∞·ªùng/X√£</option>';
      return;
    }
    const res = await fetch(`https://provinces.open-api.vn/api/p/${provinceCode}?depth=2`);
    const data = await res.json();
    const districtSelect = document.getElementById("district");
    districtSelect.innerHTML = '<option value="">Ch·ªçn Qu·∫≠n/Huy·ªán</option>';
    document.getElementById("ward").innerHTML = '<option value="">Ch·ªçn Ph∆∞·ªùng/X√£</option>';
    data.districts.forEach(d => {
      districtSelect.innerHTML += `<option value="${d.code}" ${d.name === "{{warehouse.district}}" ? "selected" : ""}>${d.name}</option>`;
    });
  }

  async function loadWards(districtCode) {
    if (!districtCode) {
      document.getElementById("ward").innerHTML = '<option value="">Ch·ªçn Ph∆∞·ªùng/X√£</option>';
      return;
    }
    const res = await fetch(`https://provinces.open-api.vn/api/d/${districtCode}?depth=2`);
    const data = await res.json();
    const wardSelect = document.getElementById("ward");
    wardSelect.innerHTML = '<option value="">Ch·ªçn Ph∆∞·ªùng/X√£</option>';
    data.wards.forEach(w => {
      wardSelect.innerHTML += `<option value="${w.code}" ${w.name === "{{warehouse.ward}}" ? "selected" : ""}>${w.name}</option>`;
    });
  }

  document.addEventListener("DOMContentLoaded", () => {
    loadProvinces();
    document.getElementById("province").addEventListener("change", e => loadDistricts(e.target.value));
    document.getElementById("district").addEventListener("change", e => loadWards(e.target.value));
  });
</script>