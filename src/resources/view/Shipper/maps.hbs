<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Báº£n Ä‘á»“ chá»‰ Ä‘Æ°á»ng</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
</head>
<body>
    <h1>Chá»‰ Ä‘Æ°á»ng Ä‘áº¿n Ä‘á»‹a chá»‰ giao hÃ ng</h1>

    <!-- ğŸ”¥ Hiá»ƒn thá»‹ hÆ°á»›ng dáº«n di chuyá»ƒn -->
    <h2>HÆ°á»›ng dáº«n Ä‘i Ä‘Æ°á»ng</h2>
    <ul>
        {{#if steps.length}}
            {{#each steps}}
                <li>{{instruction}} - ğŸ“ {{distance}}, â³ {{duration}}</li>
            {{/each}}
        {{else}}
            <p>âŒ KhÃ´ng tÃ¬m tháº¥y hÆ°á»›ng dáº«n di chuyá»ƒn.</p>
        {{/if}}
    </ul>

    <!-- ğŸ”¥ Khu vá»±c hiá»ƒn thá»‹ báº£n Ä‘á»“ -->
    <div id="map" style="width: 100%; height: 500px;"></div>
    <a id="googleMapsBtn" href="#" target="_blank">ğŸ—ºï¸ Chá»‰ Ä‘Æ°á»ng trÃªn Google Maps</a>
    <script>
    var startLat = routePath[0][1];
    var startLon = routePath[0][0];
    var endLat = routePath[routePath.length - 1][1];
    var endLon = routePath[routePath.length - 1][0];

    var googleMapsUrl = `https://www.google.com/maps/dir/${startLat},${startLon}/${endLat},${endLon}/`;

    document.getElementById("googleMapsBtn").setAttribute("href", googleMapsUrl); // ğŸš€ GÃ¡n URL Google Maps vÃ o tháº» `<a>`
</script>


    <script>
        console.log("ğŸ”¥ Kiá»ƒm tra dá»¯ liá»‡u trÆ°á»›c khi hiá»ƒn thá»‹ báº£n Ä‘á»“");

        var routePath = JSON.parse("{{{routePath}}}"); // ğŸ”¥ Dá»¯ liá»‡u tuyáº¿n Ä‘Æ°á»ng tá»« API OSRM
        console.log("âœ… Dá»¯ liá»‡u tuyáº¿n Ä‘Æ°á»ng:", routePath);

        if (!routePath || routePath.length === 0) {
            console.error("âŒ KhÃ´ng cÃ³ dá»¯ liá»‡u tuyáº¿n Ä‘Æ°á»ng! Kiá»ƒm tra API.");
        } else {
            var map = L.map('map').setView([routePath[0][1], routePath[0][0]], 13); // Tá»a Ä‘á»™ xuáº¥t phÃ¡t

            console.log("âœ… Tá»a Ä‘á»™ xuáº¥t phÃ¡t:", routePath[0]);
            console.log("âœ… Tá»a Ä‘á»™ Ä‘iá»ƒm giao hÃ ng:", routePath[routePath.length - 1]);

            // ğŸ”¥ ThÃªm báº£n Ä‘á»“ ná»n OpenStreetMap
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
            console.log("âœ… Báº£n Ä‘á»“ Ä‘Ã£ Ä‘Æ°á»£c táº£i vÃ o");

            // ğŸ”¥ Hiá»ƒn thá»‹ tuyáº¿n Ä‘Æ°á»ng tá»« API OSRM
            try {
                var routeLine = L.polyline(routePath.map(coord => [coord[1], coord[0]]), { color: 'blue', weight: 5 }).addTo(map);
                console.log("âœ… Tuyáº¿n Ä‘Æ°á»ng Ä‘Ã£ Ä‘Æ°á»£c váº½ trÃªn báº£n Ä‘á»“");
            } catch (error) {
                console.error("âŒ Lá»—i khi váº½ tuyáº¿n Ä‘Æ°á»ng:", error);
            }

            // ğŸ”¥ ÄÃ¡nh dáº¥u Ä‘iá»ƒm xuáº¥t phÃ¡t vÃ  Ä‘iá»ƒm giao hÃ ng
            try {
                L.marker([routePath[0][1], routePath[0][0]]).addTo(map).bindPopup("ğŸšš Xuáº¥t phÃ¡t").openPopup();
                L.marker([routePath[routePath.length - 1][1], routePath[routePath.length - 1][0]]).addTo(map).bindPopup("ğŸ“¦ Äiá»ƒm giao hÃ ng").openPopup();
                console.log("âœ… ÄÃ£ Ä‘áº·t marker Ä‘iá»ƒm xuáº¥t phÃ¡t vÃ  Ä‘iá»ƒm giao hÃ ng");
            } catch (error) {
                console.error("âŒ Lá»—i khi Ä‘áº·t marker:", error);
            }
        }
    </script>
</body>
</html>
