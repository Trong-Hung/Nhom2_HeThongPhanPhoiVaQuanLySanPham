<!-- filepath: src/resources/view/admin/qldonhang.hbs -->
<div class="container mt-4">
  <h3 class="mb-4">Quản lý đơn hàng</h3>

  <div class="table-responsive shadow-sm rounded">
    <table class="table table-striped table-hover align-middle">
      <thead class="thead-dark">
        <tr>
          <th scope="col" style="width: 150px;">Mã đơn</th>
          <th scope="col">Họ tên</th>
          <th scope="col" style="width: 120px;">SĐT</th>
          <th scope="col">Địa chỉ</th>
          <th scope="col" style="width: 150px;">Kho lấy hàng</th>
          <th scope="col">Địa chỉ kho</th>
          <th scope="col" style="width: 120px;">Trạng thái</th>
          <th scope="col" style="width: 160px;">Giao dự kiến</th>
          <th scope="col" style="width: 100px;">Chi tiết</th>
        </tr>
      </thead>
      <tbody>
        {{#each orders}}
          {{#if (isUrgent this.estimatedDelivery)}}
            <tr style="background-color: #d32f2f; color: #fff; font-weight: bold;">
          {{else}}
            <tr>
          {{/if}}
            <td>
              <a href="/admin/donhang/{{this._id}}" style="color:inherit; text-decoration:underline;">{{this._id}}</a>
              {{#if (isUrgent this.estimatedDelivery)}}
                <span class="badge bg-danger ms-1" style="font-size:1em; padding:6px 12px;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-exclamation-triangle-fill mb-1" viewBox="0 0 16 16">
                    <path d="M8.982 1.566a1.13 1.13 0 0 0-1.964 0L.165 13.233c-.457.778.091 1.767.982 1.767h13.707c.89 0 1.438-.99.982-1.767L8.982 1.566zm-.982 4.434a.905.905 0 1 1 1.81 0l-.35 3.507a.552.552 0 0 1-1.11 0L8 6zm.002 6a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
                  </svg>
                  Giao gấp
                </span>
              {{/if}}
            </td>
            <td>{{this.name}}</td>
            <td>{{this.phone}}</td>
            <td>{{this.address}}</td>
            <td>
              {{#if this.warehouseId}}
                {{this.warehouseId.name}}
              {{else}}
                <span class="text-danger">❌ Chưa xác định</span>
              {{/if}}
            </td>
            <td>
              {{#if this.warehouseId}}
                {{this.warehouseId.address}}
              {{else}}
                <span class="text-danger">❌ Chưa xác định</span>
              {{/if}}
            </td>
            <td>
              {{#if this.estimatedDelivery}}
                {{formatDate this.estimatedDelivery}}
              {{else}}
                <span class="text-muted">Chưa có</span>
              {{/if}}
            </td>
            <td>
              <span class="{{statusBadgeClass this.status}}">
                {{this.status}}
              </span>
            </td>
            <td>
              <a href="/admin/donhang/{{this._id}}" class="btn btn-sm btn-outline-primary">Xem</a>
            </td>
          </tr>
        {{/each}}
      </tbody>
    </table>
  </div>
</div>