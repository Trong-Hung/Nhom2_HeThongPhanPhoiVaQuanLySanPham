{{!-- filepath: c:\Users\trong\JAVASC\blog\src\resources\view\cart\payment.hbs --}}
<div class="mt-4">
  <h3>Th√¥ng tin thanh to√°n</h3>

  {{#if cart.items.length}}
    <!-- Hi·ªÉn th·ªã danh s√°ch c√°c s·∫£n ph·∫©m ƒë√£ ch·ªçn -->
    <h4>S·∫£n ph·∫©m trong gi·ªè h√†ng</h4>
    <table class="table mt-4">
      <thead>
        <tr>
          <th scope="col">T√™n s·∫£n ph·∫©m</th>
          <th scope="col">Gi√°</th>
          <th scope="col">S·ªë l∆∞·ª£ng</th>
          <th scope="col">T·ªïng ti·ªÅn</th>
        </tr>
      </thead>
      <tbody>
        {{#each cart.items}}
          <tr>
            <td>{{this.name}}</td>
            <td>{{formatCurrency this.price}}</td>
            <td>{{this.quantity}}</td>
            <td>{{formatCurrency (multiply this.price this.quantity)}}</td>
          </tr>
        {{/each}}
      </tbody>
    </table>

    <!-- Hi·ªÉn th·ªã t·ªïng s·ªë l∆∞·ª£ng v√† t·ªïng ti·ªÅn -->
    <div class="row mt-4">
      <div class="col-6">
        <p><strong>T·ªïng s·ªë l∆∞·ª£ng:</strong> {{totalQuantity}}</p>
      </div>
      <div class="col-6 text-right">
        <p><strong>T·ªïng ti·ªÅn:</strong> {{totalPrice}}</p>
      </div>
    </div>

    <!-- Form nh·∫≠p th√¥ng tin v√† ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n -->
    <form action="/cart/payment" method="POST">
      <div class="form-group">
        <label for="name">H·ªç t√™n</label>
        <input type="text" class="form-control" id="name" name="name" required />
      </div>
      <div class="form-group">
        <label for="phone">S·ªë ƒëi·ªán tho·∫°i</label>
        <input type="text" class="form-control" id="phone" name="phone" required />
      </div>
      <div class="form-group">
        <label for="detail">ƒê·ªãa ch·ªâ chi ti·∫øt</label>
        <input type="text" class="form-control" id="detail" name="detail" placeholder="S·ªë nh√†, t√™n ƒë∆∞·ªùng..." required />
      </div>

      <div class="form-group">
        <label for="province">T·ªânh/Th√†nh ph·ªë</label>
        <select class="form-control" id="province" name="province" required></select>
      </div>
      <div class="form-group">
        <label for="district">Qu·∫≠n/Huy·ªán</label>
        <select class="form-control" id="district" name="district" required></select>
      </div>
      <div class="form-group">
        <label for="ward">Ph∆∞·ªùng/X√£</label>
        <select class="form-control" id="ward" name="ward" required></select>
      </div>
      

    <div class="form-group">
  <label><strong>Ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n:</strong></label>
  <div class="form-check">
    <input class="form-check-input" type="radio" name="method" id="method-cash" value="cash" checked>
    <label class="form-check-label" for="method-cash">
      Thanh to√°n khi nh·∫≠n h√†ng
    </label>
  </div>
  <div class="form-check">
    <input class="form-check-input" type="radio" name="method" id="method-momo" value="momo">
    <label class="form-check-label" for="method-momo">
      Thanh to√°n qua MoMo
    </label>
  </div>
</div>

      <button type="submit" class="btn btn-primary btn-block">Thanh to√°n</button>
    </form>
  {{else}}
    <p>üõí Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng.</p>
  {{/if}}
</div>

<script>
  async function loadProvinces() {
    const res = await fetch("https://provinces.open-api.vn/api/?depth=1");
    const data = await res.json();
    const provinceSelect = document.getElementById("province");
    provinceSelect.innerHTML = '<option value="">Ch·ªçn T·ªânh/Th√†nh ph·ªë</option>';
    data.forEach(p => {
      provinceSelect.innerHTML += `<option value="${p.code}">${p.name}</option>`;
    });
  }

  async function loadDistricts(provinceCode) {
    if (!provinceCode) {
      document.getElementById("district").innerHTML = '<option value="">Ch·ªçn Qu·∫≠n/Huy·ªán</option>';
      document.getElementById("ward").innerHTML = '<option value="">Ch·ªçn Ph∆∞·ªùng/X√£</option>';
      return;
    }
    const res = await fetch(`https://provinces.open-api.vn/api/p/${provinceCode}?depth=2`);
    const data = await res.json();
    const districtSelect = document.getElementById("district");
    districtSelect.innerHTML = '<option value="">Ch·ªçn Qu·∫≠n/Huy·ªán</option>';
    document.getElementById("ward").innerHTML = '<option value="">Ch·ªçn Ph∆∞·ªùng/X√£</option>';
    data.districts.forEach(d => {
      districtSelect.innerHTML += `<option value="${d.code}">${d.name}</option>`;
    });
  }

  async function loadWards(districtCode) {
    if (!districtCode) {
      document.getElementById("ward").innerHTML = '<option value="">Ch·ªçn Ph∆∞·ªùng/X√£</option>';
      return;
    }
    const res = await fetch(`https://provinces.open-api.vn/api/d/${districtCode}?depth=2`);
    const data = await res.json();
    const wardSelect = document.getElementById("ward");
    wardSelect.innerHTML = '<option value="">Ch·ªçn Ph∆∞·ªùng/X√£</option>';
    data.wards.forEach(w => {
      wardSelect.innerHTML += `<option value="${w.code}">${w.name}</option>`;
    });
  }

  document.addEventListener("DOMContentLoaded", () => {
    loadProvinces();
    document.getElementById("province").addEventListener("change", e => loadDistricts(e.target.value));
    document.getElementById("district").addEventListener("change", e => loadWards(e.target.value));
  });
</script>